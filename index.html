<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Policy Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; color:#333; }
    .container { max-width:900px; margin:40px auto; background:white; padding:30px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    h1,h2,h3 { color:#005b96; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input[type="text"], select, textarea { width:100%; padding:8px; margin:4px 0 12px; border:1px solid #ccc; border-radius:4px; }
    textarea { height:80px; }
    button { margin:10px 5px 0 0; padding:10px 18px; background:#005b96; color:white; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#003f6d; }
    .skip-btn { background:#999; } .skip-btn:hover { background:#777; }
    .info-icon { cursor:pointer; font-size:1.2em; margin-left:5px; }
    .policy-output { background:#f9f9f9; padding:20px; border:1px dashed #999; border-radius:6px; max-height:600px; overflow-y:auto; }
    .modal { display:none; position:fixed; z-index:1000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); padding-top:60px; }
    .modal-content { background:white; margin:auto; padding:20px; border:1px solid #888; width:80%; max-width:500px; border-radius:8px; position:relative; }
    .close-btn { position:absolute; right:15px; top:10px; font-size:20px; font-weight:bold; cursor:pointer; } .close-btn:hover { color:red; }
    hr { margin:20px 0; } ul { margin-left:20px; }
    table { width:100%; border-collapse:collapse; margin:10px 0; } table, th, td { border:1px solid #ccc; } th, td { padding:8px; text-align:left; }
    #progressContainer { width:100%; background:#e0e0e0; height:12px; border-radius:6px; overflow:hidden; margin-top:20px; }
    #progressBar { width:0%; height:100%; background:#005b96; transition:width 0.3s; }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Policy Builder</h1>
    <p>Use this wizard to generate a comprehensive AI policy you can paste directly into Word or Google Docs.</p>
    <div id="wizard"></div>
    <div id="progressContainer"><div id="progressBar"></div></div>
  </div>

  <!-- Info Modal -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close-btn">✖️</span>
      <div id="modalText"></div>
    </div>
  </div>

<script>
// Legend for Risk screens
const RISK_LEGEND = `
  <table>
    <tr><th>Level</th><th>Definition</th></tr>
    <tr><td><strong>High Risk</strong></td>
        <td>Handles sensitive/proprietary data; drives critical decisions; strict oversight.</td></tr>
    <tr><td><strong>Medium Risk</strong></td>
        <td>Processes less sensitive data; supports human review.</td></tr>
    <tr><td><strong>Low Risk</strong></td>
        <td>General, non-sensitive tasks (e.g., marketing copy).</td></tr>
  </table>
`;

// Wizard steps
const steps = [
  { id:'company',    title:'Company Info', fields:['companyName','industry','jurisdiction','tone'],
    info:'Enter your legal business name, primary industry (e.g., Healthcare), and governing jurisdiction (e.g., Montreal, Quebec). Choose Formal Legal or Plain Language tone.' },
  { id:'scope',      title:'Scope',        fields:['scope'],
    info:'Define who (employees, contractors, interns, partners) and what (internal models, third-party AI, environments) this policy covers.' },
  { id:'definitions',title:'Definitions',  fields:['includeDefinitions'],
    info:'Include definitions of AI, ML, LLM, personal data, trade secrets, high-risk AI, etc., plus an appendix of examples.' },
  { id:'tools',      title:'Approved AI Tools', fields:['approvedToolsList','customTool'],
    info:'Select from the top-20 AI tools list and optionally add any others.' },
  { id:'riskMode',   title:'Risk Classification Mode', fields:['riskMode'],   info:'Click ℹ️ for details on risk levels and choose Global vs Per-Tool.' },
  { id:'riskClassification', title:'Global Risk Level', fields:['riskClassification'], info:'Click ℹ️ to review risk definitions before selecting one level for all tools.' },
  { id:'riskPerTool',        title:'Per-Tool Risk Classification', fields:['riskPerTool'], info:'Click ℹ️ to review risk definitions before assigning per-tool levels.' },
  { id:'privacy',   title:'Data Privacy & Security', fields:['personalData','financialData','tradeSecrets','anonymize','encryption'],
    info:'Specify data types AI will handle and whether anonymization or encryption is required.' },
  { id:'prohibited',title:'Prohibited Use Cases', fields:['prohibitedUses','customProhibited'],
    info:'Select common prohibited scenarios and add custom ones.' },
  { id:'governance',title:'Approved Use & Governance', fields:['requireApproval'],
    info:'Decide if new AI tools need formal risk, security & ethics review before approval.' },
  { id:'ip',        title:'IP & Trade Secrets', fields:['ipOwnership','protectTradeSecrets'],
    info:'Clarify that AI outputs using company data are company-owned IP and protect trade secrets.' },
  { id:'fairness',  title:'Fairness & Bias Mitigation', fields:['biasReview','biasAuditFrequency','customBiasRequirements'],
    info:'State bias review requirements, audit frequency, and any additional fairness controls.' },
  { id:'compliance',title:'Compliance & Legal', fields:['laws','customLaws','exportControls','customExport'],
    info:'Select applicable privacy laws & export-control regimes. Full definitions & links in modal ℹ️.' },
  { id:'transparency',title:'Transparency & Explainability', fields:['publicDisclosure','explainability'],
    info:'Decide if policy is public and if employees must explain AI decisions.' },
  { id:'training',  title:'Training & Awareness', fields:['training','trainingDetails','acknowledgment','ackDetails'],
    info:'Outline mandatory AI ethics/security training and acknowledgment process.' },
  { id:'vendorContracts',title:'Vendor & Contract Clauses', fields:['vendorClauses','customVendorClauses'],
    info:'Require contract clauses for third-party AI vendors covering security, privacy, ethics.' },
  { id:'dataRetention',title:'Data Retention', fields:['dataRetention','customDataRetention'],
    info:'Specify retention periods for AI training data, logs, model artifacts.' },
  { id:'logging',    title:'Logging & Monitoring', fields:['enableLogging','logRetention','customLogRetention'],
    info:'Enable usage logging and set log retention periods.' },
  { id:'marketing',  title:'AI in Marketing & Community Content', 
    fields:['socialChannels','customSocialChannels','creativeTools','customCreativeTools','approvalName','approvalEmail','approvalPhone','approvalSlack','approvalTeams','cautionPersonal','cautionDetails'],
    info:'Define rules for AI-generated social, marketing & community content—including approvals & personal-account cautions.' },
  { id:'incidents',  title:'Incident Reporting & Response', fields:['incidentEmail','incidentPhone','incidentSlack','incidentTeams'],
    info:'Provide email, phone, Slack & Teams channels for immediate incident reporting.' },
  { id:'review',     title:'Review & Updates', fields:['reviewFrequency','responsibleTeam'],
    info:'Choose how often to review this policy and which team owns the process.' },
  { id:'signoff',    title:'Sign-off & Acknowledgment', fields:['signOff'],
    info:'Decide if employees must sign or click-acknowledge before using AI.' }
];

let formData = {}, currentStep = 0;
const wizardDiv   = document.getElementById('wizard');
const progressBar = document.getElementById('progressBar');
const modal       = document.getElementById('infoModal');
const modalText   = document.getElementById('modalText');
const closeModal  = document.getElementById('closeModal');

// Render a single field
function getFieldHTML(f) {
  switch(f) {
    case 'companyName': return '<label>Company Name:</label><input type="text" id="companyName">';
    case 'industry':
      return `<label>Industry:</label>
        <select id="industry">
          <option>Education</option><option>Financial Services</option>
          <option>Healthcare / Medical</option><option>Insurance</option>
          <option>Legal / Compliance</option><option>Manufacturing</option>
          <option>Retail / E-commerce</option><option>Technology</option>
          <option>Other</option>
        </select>`;
    case 'jurisdiction': return '<label>Jurisdiction (e.g., Montreal, Quebec):</label><input type="text" id="jurisdiction">';
    case 'tone':
      return `<label>Policy Tone:</label>
        <select id="tone">
          <option value="formal">Formal Legal</option>
          <option value="plain">Plain Language</option>
        </select>`;
    case 'scope':
      return `<label>Applies to:</label>
        <select id="scope">
          <option value="all">All employees, contractors, interns & partners</option>
          <option value="employees">Employees only</option>
        </select>`;
    case 'includeDefinitions':
      return `<label>Include definitions & appendix?</label>
        <select id="includeDefinitions"><option>Yes</option><option>No</option></select>`;
    case 'approvedToolsList':
      return `<label>Approved AI Tools:</label>
        <select id="approvedToolsList" multiple size="5">
          <option>Canva (Magic Studio)</option><option>CapCut</option>
          <option>Character.ai</option><option>ChatGPT (GPT-4o)</option>
          <option>Claude 3.7 Sonnet</option><option>DeepAI</option>
          <option>DeepL + DeepL Write</option><option>ElevenLabs</option>
          <option>Google Gemini</option><option>Grammarly (Gen-AI edition)</option>
          <option>Hugging Face</option><option>Midjourney v7</option>
          <option>Microsoft Copilot</option><option>Poe (Quora)</option>
          <option>Perplexity AI</option><option>Quizizz (AI quizzes)</option>
          <option>QuillBot</option><option>Remove.bg</option>
          <option>Suno</option><option>Zapier (AI Chat + Actions)</option>
        </select>`;
    case 'customTool': return `<label>Other tools:</label><textarea id="customTool" placeholder="…"></textarea>`;

    case 'riskMode':
      return RISK_LEGEND + `
        <label>Risk mode:</label>
        <select id="riskMode">
          <option value="global">Global (one level for all)</option>
          <option value="perTool">Per-Tool (custom per tool)</option>
        </select>`;
    case 'riskClassification':
      return RISK_LEGEND + `
        <label>Select global risk level:</label>
        <select id="riskClassification"><option>High</option><option>Medium</option><option>Low</option></select>`;
    case 'riskPerTool':
      let html = RISK_LEGEND + `<p>Assign each tool its own risk level:</p>`;
      (formData.approvedToolsList||[]).forEach((tool,i)=>{
        html += `<label>Risk for "${tool}":</label>
                 <select id="riskTool_${i}"><option>High</option><option>Medium</option><option>Low</option></select><br>`;
      });
      if(formData.customTool){
        html += `<label>Risk for "${formData.customTool}":</label>
                 <select id="riskTool_custom"><option>High</option><option>Medium</option><option>Low</option></select><br>`;
      }
      return html;

    case 'personalData':  return `<label><input type="checkbox" id="personalData"> Handle personal data</label>`;
    case 'financialData': return `<label><input type="checkbox" id="financialData"> Handle financial data</label>`;
    case 'tradeSecrets':  return `<label><input type="checkbox" id="tradeSecrets"> Handle trade secrets/IP</label>`;
    case 'anonymize':     return `<label><input type="checkbox" id="anonymize"> Require anonymization</label>`;
    case 'encryption':    return `<label>Require encryption?</label><select id="encryption"><option>Yes</option><option>No</option></select>`;

    case 'prohibitedUses':
      return `<label>Prohibited use cases:</label>
        <select id="prohibitedUses" multiple>
          <option>Uploading confidential documents</option>
          <option>Automated hiring/credit/medical decisions</option>
          <option>Providing legal advice</option>
          <option>Generating disallowed content</option>
        </select>`;
    case 'customProhibited': return `<label>Other prohibited uses:</label><textarea id="customProhibited"></textarea>`;

    case 'requireApproval':
      return `<label>Require review for new tools?</label><select id="requireApproval"><option>Yes</option><option>No</option></select>`;

    case 'ipOwnership':
      return `<label>Company-owned AI outputs?</label><select id="ipOwnership"><option>Yes</option><option>No</option></select>`;
    case 'protectTradeSecrets':
      return `<label>Emphasize trade-secret protection?</label><select id="protectTradeSecrets"><option>Yes</option><option>No</option></select>`;

    case 'biasReview':
      return `<label>Require bias audits?</label><select id="biasReview"><option>Yes</option><option>No</option></select>`;
    case 'biasAuditFrequency':
      return `<label>Audit frequency:</label><select id="biasAuditFrequency"><option>Quarterly</option><option>Semi-annual</option><option>Annual</option></select>`;
    case 'customBiasRequirements':
      return `<label>Additional fairness controls:</label><textarea id="customBiasRequirements"></textarea>`;

    case 'laws':
      return `<label>Applicable laws:</label>
        <select id="laws" multiple>
          <option>GDPR (EU)</option>
          <option>CCPA/CPRA (California)</option>
          <option>Quebec Law 25</option>
          <option>PIPEDA (Canada)</option>
          <option>HIPAA (US)</option>
        </select>`;
    case 'customLaws':     return `<label>Other laws:</label><textarea id="customLaws"></textarea>`;
    case 'exportControls':
      return `<label>Export control regimes:</label>
        <select id="exportControls" multiple>
          <option>U.S. EAR/ITAR</option><option>EU Dual-use</option><option>UK Export Controls</option>
        </select>`;
    case 'customExport':   return `<label>Other regimes:</label><textarea id="customExport"></textarea>`;

    case 'publicDisclosure':
      return `<label>Share policy publicly?</label><select id="publicDisclosure"><option>Yes</option><option>No</option></select>`;
    case 'explainability':
      return `<label>Require explainability?</label><select id="explainability"><option>Yes</option><option>No</option></select>`;

    case 'training':
      return `<label>Mandatory training?</label><select id="training"><option>Yes</option><option>No</option></select>`;
    case 'trainingDetails': return `<label>Training details:</label><textarea id="trainingDetails"></textarea>`;
    case 'acknowledgment':
      return `<label>Require acknowledgment?</label><select id="acknowledgment"><option>Yes</option><option>No</option></select>`;
    case 'ackDetails':     return `<label>Acknowledgment instructions:</label><textarea id="ackDetails"></textarea>`;

    case 'vendorClauses':
      return `<label>Include vendor clauses?</label><select id="vendorClauses"><option>Yes</option><option>No</option></select>`;
    case 'customVendorClauses': return `<label>Vendor clause details:</label><textarea id="customVendorClauses"></textarea>`;

    case 'dataRetention':
      return `<label>Retention period:</label><select id="dataRetention"><option>1 year</option><option>3 years</option><option>5 years</option><option>Indefinite</option></select>`;
    case 'customDataRetention': return `<label>Other retention:</label><textarea id="customDataRetention"></textarea>`;

    case 'enableLogging':
      return `<label><input type="checkbox" id="enableLogging"> Enable usage logging</label>`;
    case 'logRetention':
      return `<label>Log retention:</label><select id="logRetention"><option>6 months</option><option>1 year</option><option>3 years</option><option>Indefinite</option></select>`;
    case 'customLogRetention': return `<label>Other log policy:</label><textarea id="customLogRetention"></textarea>`;

    case 'socialChannels':
      return `<label>Social channels:</label><select id="socialChannels" multiple><option>LinkedIn</option><option>Twitter</option><option>Instagram</option><option>Facebook</option><option>TikTok</option><option>YouTube</option></select>`;
    case 'customSocialChannels': return `<label>Other channels:</label><textarea id="customSocialChannels"></textarea>`;
    case 'creativeTools':
      return `<label>Creative AI tools:</label><select id="creativeTools" multiple><option>Canva</option><option>Midjourney v7</option><option>DALL·E 3</option><option>Adobe Firefly</option><option>Stable Diffusion</option></select>`;
    case 'customCreativeTools': return `<label>Other creative tools:</label><textarea id="customCreativeTools"></textarea>`;
    case 'approvalName':   return `<label>Approval team/name:</label><input type="text" id="approvalName">`;
    case 'approvalEmail':  return `<label>Approval email:</label><input type="text" id="approvalEmail">`;
    case 'approvalPhone':  return `<label>Approval phone:</label><input type="text" id="approvalPhone">`;
    case 'approvalSlack':  return `<label>Approval Slack channel:</label><input type="text" id="approvalSlack">`;
    case 'approvalTeams':  return `<label>Approval Teams channel:</label><input type="text" id="approvalTeams">`;
    case 'cautionPersonal':return `<label><input type="checkbox" id="cautionPersonal"> Caution using company data on personal accounts</label>`;
    case 'cautionDetails': return `<label>Caution details:</label><textarea id="cautionDetails"></textarea>`;

    case 'incidentEmail':  return `<label>Incident email:</label><input type="text" id="incidentEmail">`;
    case 'incidentPhone':  return `<label>Incident phone:</label><input type="text" id="incidentPhone">`;
    case 'incidentSlack':  return `<label>Incident Slack channel:</label><input type="text" id="incidentSlack">`;
    case 'incidentTeams':  return `<label>Incident Teams channel:</label><input type="text" id="incidentTeams">`;

    case 'reviewFrequency':
      return `<label>Review frequency:</label><select id="reviewFrequency"><option>Annually</option><option>Semi-annual</option><option>As needed</option></select>`;
    case 'responsibleTeam': return `<label>Responsible team:</label><input type="text" id="responsibleTeam">`;
    case 'signOff':
      return `<label>Require sign-off?</label><select id="signOff"><option>Yes</option><option>No</option></select>`;

    default: return '';
  }
}

// Modal and navigation
closeModal.onclick = ()=> modal.style.display='none';
window.onclick = e=> { if(e.target===modal) modal.style.display='none'; };

function showInfo(html) {
  const sid = steps[currentStep].id;
  if (['riskMode','riskClassification','riskPerTool'].includes(sid)) {
    modalText.innerHTML = `
      <h3>Risk Classification Details</h3>
      <p>Classify this AI system as <strong>High</strong>, <strong>Medium</strong>, or <strong>Low</strong> risk:</p>
      <ul>
        <li><strong>High Risk:</strong> Sensitive/proprietary data; critical decisions; strict oversight; full audits & sign-off.</li>
        <li><strong>Medium Risk:</strong> Less sensitive data; human-in-the-loop; quarterly bias checks.</li>
        <li><strong>Low Risk:</strong> General, non-sensitive tasks; standard monitoring.</li>
      </ul>`;
  }
  else if (sid==='compliance') {
    modalText.innerHTML = `
      <h3>Compliance & Legal – Details</h3>
      <ul>
        <li><strong>GDPR (EU):</strong> EU data privacy regulation. <a href="https://gdpr.eu" target="_blank">Learn more</a></li>
        <li><strong>CCPA/CPRA (CA):</strong> California consumer data rights. <a href="https://oag.ca.gov/privacy/ccpa" target="_blank">Learn more</a></li>
        <li><strong>Quebec Law 25:</strong> Quebec private-sector privacy modernization. <a href="https://www.legisquebec.gouv.qc.ca/en/document/cs/P-39.1" target="_blank">Learn more</a></li>
        <li><strong>PIPEDA (Canada):</strong> Federal Canadian privacy law. <a href="https://www.priv.gc.ca/en/privacy-topics/the-personal-information-protection-and-electronic-documents-act-pipeda/" target="_blank">Learn more</a></li>
        <li><strong>HIPAA (US):</strong> US medical information privacy. <a href="https://www.hhs.gov/hipaa" target="_blank">Learn more</a></li>
      </ul>
      <h4>Export Controls</h4>
      <ul>
        <li><strong>U.S. EAR/ITAR:</strong> US defense/high-tech exports. <a href="https://www.bis.doc.gov" target="_blank">Learn more</a></li>
        <li><strong>EU Dual-use:</strong> EU dual-use item controls. <a href="https://trade.ec.europa.eu" target="_blank">Learn more</a></li>
        <li><strong>UK Export Controls:</strong> UK controlled goods. <a href="https://www.gov.uk" target="_blank">Learn more</a></li>
      </ul>`;
  }
  else {
    modalText.innerHTML = html;
  }
  modal.style.display = 'block';
}

// Save data
function saveStepData(){
  steps[currentStep].fields.forEach(f=>{
    if(f.startsWith('riskTool_')) return;
    const el = document.getElementById(f);
    if(!el) return;
    if(el.type==='checkbox') formData[f] = el.checked;
    else if(el.multiple) formData[f] = [...el.selectedOptions].map(o=>o.value);
    else formData[f] = el.value;
  });
  if(steps[currentStep].id==='riskPerTool'){
    formData.toolRisks = {};
    (formData.approvedToolsList||[]).forEach((tool,i)=>{
      formData.toolRisks[tool] = document.getElementById(`riskTool_${i}`).value;
    });
    if(formData.customTool){
      formData.toolRisks[formData.customTool] = document.getElementById('riskTool_custom').value;
    }
  }
}

// Navigation
function prevStep(){
  currentStep = Math.max(0, currentStep-1);
  // skip mismatched risk screens
  while(true){
    const s = steps[currentStep];
    if((s.id==='riskPerTool' && formData.riskMode!=='perTool') ||
       (s.id==='riskClassification' && formData.riskMode==='perTool')){
      currentStep = Math.max(0, currentStep-1);
      continue;
    }
    break;
  }
  renderStep();
}
function nextStep(){ saveStepData(); currentStep++; renderStep(); }
function skipStep(){ currentStep++; renderStep(); }

// Render wizard step
function renderStep(){
  if(currentStep >= steps.length) return renderFinal();
  const s = steps[currentStep];
  if(s.id==='riskPerTool' && formData.riskMode!=='perTool'){ currentStep++; return renderStep(); }
  if(s.id==='riskClassification' && formData.riskMode==='perTool'){ currentStep++; return renderStep(); }

  const infoEsc = s.info.replace(/`/g,'\\`');
  let html = `<h2>${s.title} <span class="info-icon" onclick="showInfo(\`${infoEsc}\`)">ℹ️</span></h2>`;
  s.fields.forEach(f=> html += getFieldHTML(f));
  html += `<button onclick="prevStep()">Previous</button>
           <button onclick="nextStep()">Next</button>
           <button class="skip-btn" onclick="skipStep()">Skip</button>`;
  wizardDiv.innerHTML = html;
  progressBar.style.width = Math.round((currentStep/steps.length)*100) + '%';
}

// ---- Final document rendering functions ----
function heading(n,t){ return `<h3>${n}. ${t}</h3>`; }

function sectionIntro(){
  const c = formData.companyName||'[Company Name]', j = formData.jurisdiction||'[Jurisdiction]';
  return heading(1,'Introduction & Purpose')+`
<p>This policy establishes principles, rules, and controls for safe, ethical, and compliant use of AI across <strong>${c}</strong>. Our objectives:</p>
<ul>
  <li>Safeguard customer & employee data;</li>
  <li>Protect trade secrets & intellectual property;</li>
  <li>Prevent bias & discriminatory outcomes;</li>
  <li>Uphold all applicable laws & industry standards;</li>
  <li>Maintain trust of customers, partners, and the public;</li>
  <li>Operate under the laws of ${j}.</li>
</ul><hr>`;
}

function sectionScope(){
  const who = formData.scope==='employees' ? 'Employees only.' : 'Employees, contractors, interns & partners.';
  return heading(2,'Scope')+`
<ul>
  <li><strong>Who:</strong> ${who}</li>
  <li><strong>What:</strong> Internal models, third-party AI services, generative/predictive systems.</li>
  <li><strong>Where/When:</strong> On-premises, remote, mobile—any device.</li>
</ul><hr>`;
}

function sectionDefinitions(){
  if(formData.includeDefinitions!=='Yes') return '';
  return heading(3,'Definitions')+`
<table>
  <tr><th>Term</th><th>Definition</th></tr>
  <tr><td><strong>AI</strong></td><td>Systems performing tasks requiring human-like intelligence.</td></tr>
  <tr><td><strong>Machine Learning</strong></td><td>Algorithms learning patterns from data to predict or decide.</td></tr>
  <tr><td><strong>LLM</strong></td><td>Large language models trained on massive text datasets.</td></tr>
  <tr><td><strong>Personal Data</strong></td><td>Information identifying a person (GDPR/CCPA/Law 25).</td></tr>
  <tr><td><strong>Trade Secret</strong></td><td>Confidential information with competitive value.</td></tr>
  <tr><td><strong>High-Risk AI</strong></td><td>Affects critical decisions or handles sensitive data.</td></tr>
</table><hr>`;
}

function sectionTools(){
  const list = (formData.approvedToolsList||[]).map(t=>`<li>${t}</li>`).join('')+
               (formData.customTool?`<li>${formData.customTool}</li>`:'');
  return heading(4,'Approved AI Tools')+`<ul>${list}</ul><hr>`;
}

function sectionPrivacy(){
  const items=[];
  if(formData.personalData)   items.push('Never share personal data with public AI without explicit authorization.');
  if(formData.tradeSecrets)   items.push('Protect trade secrets in secure, access-controlled environments.');
  if(formData.financialData)  items.push('Handle financial data under stringent compliance and encryption.');
  if(formData.anonymize)      items.push('Anonymize or de-identify data before training/testing.');
  if(formData.encryption)     items.push('Encrypt AI data at rest and in transit.');
  if(!items.length) return '';
  return heading(5,'Data Privacy & Security')+`<ol>${items.map(i=>`<li>${i}</li>`).join('')}</ol><hr>`;
}

function sectionProhibited(){
  const list = (formData.prohibitedUses||[]).map(u=>`<li>${u}</li>`).join('')+
               (formData.customProhibited?`<li>${formData.customProhibited}</li>`:'');
  return heading(6,'Prohibited Use Cases')+`<ul>${list}</ul><hr>`;
}

function sectionGovernance(){
  return heading(7,'Approved Use & Governance')+`
<p>${formData.requireApproval==='Yes'
  ? 'All new AI tools must undergo formal risk, security & ethics review before approval.'
  : 'No formal approval workflow defined.'}</p><hr>`;
}

function sectionIP(){
  return heading(8,'Intellectual Property & Trade Secrets')+`
<p>${formData.ipOwnership==='Yes'
  ? 'All AI outputs using company data are company-owned IP.'
  : 'Ownership follows project agreements.'}</p>
<p>${formData.protectTradeSecrets==='Yes'
  ? 'Employees must not disclose trade secrets via AI tools.'
  : 'Standard confidentiality applies.'}</p><hr>`;
}

function sectionBias(){
  let out=`<p>${formData.biasReview==='Yes'
    ? 'High-risk AI systems require a documented Bias & Fairness Review before deployment.'
    : 'No mandatory bias/fairness review.'}</p>`;
  if(formData.biasAuditFrequency) out+=`<p>Bias audits occur <strong>${formData.biasAuditFrequency}</strong>.</p>`;
  if(formData.customBiasRequirements) out+=`<p>${formData.customBiasRequirements}</p>`;
  return heading(9,'Fairness & Bias Mitigation')+out+'<hr>';
}

function sectionCompliance(){
  let out=heading(10,'Compliance & Legal')+'<ul>';
  (formData.laws||[]).forEach(law=>{
    switch(law){
      case 'GDPR (EU)': out+=`<li><strong>GDPR (EU):</strong> EU data privacy regulation. <a href="https://gdpr.eu" target="_blank">Learn more</a></li>`; break;
      case 'CCPA/CPRA (California)': out+=`<li><strong>CCPA/CPRA (California):</strong> CA consumer privacy law. <a href="https://oag.ca.gov/privacy/ccpa" target="_blank">Learn more</a></li>`; break;
      case 'Quebec Law 25': out+=`<li><strong>Quebec Law 25:</strong> Quebec privacy modernization. <a href="https://www.legisquebec.gouv.qc.ca/en/document/cs/P-39.1" target="_blank">Learn more</a></li>`; break;
      case 'PIPEDA (Canada)': out+=`<li><strong>PIPEDA:</strong> CAN private-sector privacy law. <a href="https://www.priv.gc.ca" target="_blank">Learn more</a></li>`; break;
      case 'HIPAA (US)': out+=`<li><strong>HIPAA (US):</strong> US medical privacy law. <a href="https://www.hhs.gov/hipaa" target="_blank">Learn more</a></li>`; break;
      default: out+=`<li>${law}</li>`;
    }
  });
  if(formData.customLaws) out+=`<li>${formData.customLaws}</li>`;
  if(formData.exportControls?.length){
    out+=`<li><strong>Export Controls:</strong><ul>`;
    formData.exportControls.forEach(x=>{
      switch(x){
        case 'U.S. EAR/ITAR': out+=`<li><strong>U.S. EAR/ITAR:</strong> US defense exports. <a href="https://www.bis.doc.gov" target="_blank">Learn more</a></li>`; break;
        case 'EU Dual-use': out+=`<li><strong>EU Dual-use:</strong> EU dual-use controls. <a href="https://trade.ec.europa.eu" target="_blank">Learn more</a></li>`; break;
        case 'UK Export Controls': out+=`<li><strong>UK Export Controls:</strong> UK controlled goods. <a href="https://www.gov.uk" target="_blank">Learn more</a></li>`; break;
        default: out+=`<li>${x}</li>`;
      }
    });
    if(formData.customExport) out+=`<li>${formData.customExport}</li>`;
    out+='</ul></li>';
  }
  out+='<li>Supplements Information Security, Code of Conduct & IP policies.</li></ul><hr>';
  return out;
}

function sectionTransparency(){
  return heading(11,'Transparency & Explainability')+`
<p>${formData.publicDisclosure==='Yes'
  ? 'Policy & AI usage details are publicly disclosed.'
  : 'No public disclosure at this time.'}</p>
<p>${formData.explainability==='Yes'
  ? 'Employees must explain AI-driven decisions upon request.'
  : 'No explainability requirement.'}</p><hr>`;
}

function sectionTraining(){
  let out=`<p>${formData.training==='Yes'
    ? 'Mandatory onboarding on AI fundamentals, ethics, privacy & this policy.'
    : 'Training recommended but optional.'}</p>`;
  if(formData.trainingDetails) out+=`<p>${formData.trainingDetails}</p>`;
  out+=`<p>${formData.acknowledgment==='Yes'
    ? 'Employees must acknowledge this policy via the HR portal.'
    : 'No formal acknowledgment required.'}</p>`;
  if(formData.ackDetails) out+=`<p>${formData.ackDetails}</p>`;
  return heading(12,'Training & Awareness')+out+'<hr>';
}

function sectionVendorContracts(){
  return heading(13,'Vendor & Contract Clauses')+`
<p>${formData.vendorClauses==='Yes'
  ? 'All third-party AI vendors must sign security, privacy & ethics clauses.'
  : 'No vendor clause requirement.'}</p>
<p>${formData.customVendorClauses||''}</p><hr>`;
}

function sectionDataRetention(){
  const dr = formData.dataRetention||'Not specified';
  return heading(14,'Data Retention')+`
<p>AI data, logs & artifacts retained for <strong>${dr}</strong>.</p>
<p>${formData.customDataRetention||''}</p><hr>`;
}

function sectionLogging(){
  const en = formData.enableLogging?'Yes':'No', lr = formData.logRetention||'Not specified';
  return heading(15,'Logging & Monitoring')+`
<p>Logging enabled: <strong>${en}</strong>.</p>
<p>Log retention: <strong>${lr}</strong>.</p>
<p>${formData.customLogRetention||''}</p><hr>`;
}

function sectionMarketing(){
  const chans = (formData.socialChannels||[]).join(', ')||'None',
        cch   = formData.customSocialChannels?`, ${formData.customSocialChannels}`:'',
        tools = (formData.creativeTools||[]).join(', ')||'None',
        ct    = formData.customCreativeTools?`, ${formData.customCreativeTools}`:'',
        approval = [
          formData.approvalName && `Name/Team: ${formData.approvalName}`,
          formData.approvalEmail&& `Email: ${formData.approvalEmail}`,
          formData.approvalPhone&& `Phone: ${formData.approvalPhone}`,
          formData.approvalSlack&& `Slack: ${formData.approvalSlack}`,
          formData.approvalTeams&& `Teams: ${formData.approvalTeams}`
        ].filter(Boolean).join('; ')||'None specified';
  return heading(16,'AI in Marketing & Community Content')+`
<p><strong>Social Channels:</strong> ${chans}${cch}</p>
<p><strong>Creative Tools:</strong> ${tools}${ct}</p>
<p><strong>Approval Workflow:</strong> ${approval}</p>
<p><strong>Caution:</strong> ${formData.cautionPersonal
      ? `Be cautious using company data on personal accounts: ${formData.cautionDetails}`
      : 'No special caution.'}</p>
<ul>
  <li>Follow Brand Guidelines.</li>
  <li>Pre-publish review if required.</li>
  <li>Use anonymized community content only.</li>
  <li>Disclose AI usage with <code>#AIGenerated</code>.</li>
</ul><hr>`;
}

function sectionRisk(){
  if(formData.riskMode==='perTool'){
    let rows='';
    for(const [tool,lvl] of Object.entries(formData.toolRisks||{})){
      rows+=`<tr><td>${tool}</td><td>${lvl}</td><td>${
        lvl==='High'   ? 'Full security, bias & ethics review' :
        lvl==='Medium' ? 'Quarterly audits & human oversight' :
                         'Standard monitoring'
      }</td></tr>`;
    }
    return heading(17,'Risk Classification & Controls')+`
<p>Per-tool risk levels & controls:</p>
<table>
  <tr><th>Tool</th><th>Risk Level</th><th>Controls</th></tr>
  ${rows}
</table><hr>`;
  } else {
    const lvl = formData.riskClassification||'Not specified';
    return heading(17,'Global Risk Classification')+`
<p>Global risk level: <strong>${lvl}</strong>.</p>
<p>${lvl==='High'
      ? 'Full security, bias & ethics reviews for all tools.'
      : lvl==='Medium'
        ? 'Quarterly audits & human oversight.'
        : 'Standard monitoring.'}</p><hr>`;
  }
}

function sectionIncidents(){
  const parts=[];
  if(formData.incidentEmail) parts.push(`Email: ${formData.incidentEmail}`);
  if(formData.incidentPhone) parts.push(`Phone: ${formData.incidentPhone}`);
  if(formData.incidentSlack) parts.push(`Slack: ${formData.incidentSlack}`);
  if(formData.incidentTeams) parts.push(`Teams: ${formData.incidentTeams}`);
  return heading(18,'Incident Reporting & Response')+`
<p>Report AI incidents via ${parts.join(', ')}.</p>
<ul>
  <li>Triage by Security & Governance lead.</li>
  <li>Remediation plan within 10 business days.</li>
  <li>Notify regulators/customers per obligations.</li>
</ul><hr>`;
}

function sectionReview(){
  return heading(19,'Review & Updates')+`
<ul>
  <li>Frequency: <strong>${formData.reviewFrequency||'Not specified'}</strong>.</li>
  <li>Responsible Team: <strong>${formData.responsibleTeam||'Not specified'}</strong>.</li>
</ul><hr>`;
}

function sectionSignoff(){
  return heading(20,'Sign-off & Acknowledgment')+`
<p>${formData.signOff==='Yes'
    ? 'All personnel must sign or acknowledge before using AI tools.'
    : 'No sign-off required.'}</p><hr>`;
}

function renderFinal(){
  let out='';
  out += sectionIntro();
  out += sectionScope();
  out += sectionDefinitions();
  out += sectionTools();
  out += sectionPrivacy();
  out += sectionProhibited();
  out += sectionGovernance();
  out += sectionIP();
  out += sectionBias();
  out += sectionCompliance();
  out += sectionTransparency();
  out += sectionTraining();
  out += sectionVendorContracts();
  out += sectionDataRetention();
  out += sectionLogging();
  out += sectionMarketing();
  out += sectionRisk();
  out += sectionIncidents();
  out += sectionReview();
  out += sectionSignoff();
  out += `<p><em>Approved by: ______________________  Date: ___________  Version: 1.0</em></p>
          <p><em>Generated with AI Policy Builder. Review with legal & compliance teams. No liability assumed.</em></p>`;
  wizardDiv.innerHTML = `<h2>Preview & Copy</h2>
    <div class="policy-output">${out}</div>
    <button onclick="copyRichText()">Copy to Clipboard</button>`;
}

function copyRichText(){
  const div = document.querySelector('.policy-output');
  const range = document.createRange();
  range.selectNode(div);
  window.getSelection().removeAllRanges();
  window.getSelection().addRange(range);
  document.execCommand('copy');
  window.getSelection().removeAllRanges();
  alert('Policy copied to clipboard!');
}

// Kick off
renderStep();
</script>
</body>
</html>
